!function(e){"use strict";const s=e("./_common/output-mgr.js"),t=e("./_common/common-config.js"),o=e("./_common/input-mgr.js"),n=e("./_common/semver.js"),r=e("./_common/sync-check.js");e("child_process"),e("os"),e("crypto"),e("fs"),e("path"),e("http"),e("https"),e("net"),e("tls"),e("events"),e("assert"),e("util"),e("stream"),e("buffer"),e("querystring"),e("stream/web"),e("node:stream"),e("node:util"),e("node:events"),e("worker_threads"),e("perf_hooks"),e("util/types"),e("async_hooks"),e("console"),e("url"),e("zlib"),e("string_decoder"),e("diagnostics_channel"),e("timers"),e("./_common/github.js");class c extends s.OutputMgr{log(){let e;for(const[s,t]of this)"changelog"===s?e=t:this.logOne(s,t);return e&&s.coreExports.info(`changelog:\n=====================\n${e}`),this}*virtualIter(){this.has("release-type","in-sync")&&(yield["should-release",!0]);const e=this.has("next-version")&&n.SemVer.parse(this.get("next-version"));e&&(yield["next-version-major",e.major],yield["next-version-minor",e.minor],yield["next-version-patch",e.patch])}}s.__decorate([s.OutputGroup("Outputs")],c.prototype,"log",null),async function(){const e=new t.TypesInputParser,a=new o.InputMgrImpl(t.commonConfigInit(e));a.load();const i=new c,l=await n.SemVer.resolveLastRelease();i.set("last-tag",l?.toString());const m=new t.CommitLoader({breakingChangeKeywords:a["breaking-change-keywords"],from:l});await m.load(),i.set("commit-count",m.totalCount),i.set("relevant-commit-count",m.relevantCount);const u=new t.CommitParser(m,e,a);u.parse(),u.hasIssuesClosed?i.set("issues-closed",[...u.issuesClosed()].join(",")):s.coreExports.debug("No issues closed");const g=new t.ChangelogGenerator(u,e,a);await g.generate(l),i.set("release-type",g.nextVersion.computeReleaseType(l)),i.set("next-version",g.nextVersion.toString()),i.set("changelog",g.result);try{await r.OutOfSyncError.check(),i.set("in-sync",!0)}catch{}i.log().flush()}().catch((e=>{s.coreExports.setFailed(s.coreExports.isDebug()?e.stack??e.message:e.message)}))}(require,Reflect,console,0,Error,JSON,Math,process,TypeError,0,Symbol);
